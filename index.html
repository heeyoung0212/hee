import React, { useState, useEffect } from 'react';
import { AlertDialog, AlertDialogContent, AlertDialogHeader, AlertDialogTitle, AlertDialogDescription, AlertDialogAction } from '@/components/ui/alert-dialog';

const ColorFillGame = () => {
  const [grid, setGrid] = useState([]);
  const [score, setScore] = useState(0);
  const [timeLeft, setTimeLeft] = useState(15);
  const [isGameOver, setIsGameOver] = useState(false);
  const [gameStarted, setGameStarted] = useState(false);

  const initializeGrid = () => {
    const newGrid = [];
    for (let i = 0; i < 5; i++) {
      newGrid.push(Array(5).fill(null));
    }
    setGrid(newGrid);
  };

  const startGame = () => {
    initializeGrid();
    setScore(0);
    setTimeLeft(15);
    setIsGameOver(false);
    setGameStarted(true);
  };

  const handleCellClick = (rowIndex, colIndex) => {
    if (!gameStarted || isGameOver) return;

    const newGrid = [...grid];
    if (!newGrid[rowIndex][colIndex]) {
      newGrid[rowIndex][colIndex] = 'red';
      setGrid(newGrid);
      setScore(prevScore => prevScore + 1);

      // 모든 칸이 채워졌는지 확인
      if (newGrid.every(row => row.every(cell => cell === 'red'))) {
        setIsGameOver(true);
      }
    }
  };

  useEffect(() => {
    if (gameStarted && !isGameOver) {
      const timer = setInterval(() => {
        setTimeLeft(prevTime => {
          if (prevTime <= 1) {
            clearInterval(timer);
            setIsGameOver(true);
            return 0;
          }
          return prevTime - 1;
        });
      }, 1000);

      return () => clearInterval(timer);
    }
  }, [gameStarted, isGameOver]);

  return (
    <div className="flex flex-col items-center justify-center min-h-screen bg-gray-100">
      <h1 className="text-3xl font-bold mb-4">색 빨리 채우기 게임</h1>
      {!gameStarted ? (
        <button
          onClick={startGame}
          className="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded"
        >
          게임 시작
        </button>
      ) : (
        <>
          <div className="mb-4">
            <p className="text-xl">점수: {score}</p>
            <p className="text-xl">남은 시간: {timeLeft}초</p>
          </div>
          <div className="grid grid-cols-5 gap-2">
            {grid.map((row, rowIndex) =>
              row.map((cell, colIndex) => (
                <div
                  key={`${rowIndex}-${colIndex}`}
                  onClick={() => handleCellClick(rowIndex, colIndex)}
                  className={`w-16 h-16 border-2 border-gray-300 cursor-pointer ${
                    cell ? 'bg-red-500' : 'bg-white'
                  }`}
                />
              ))
            )}
          </div>
        </>
      )}
      <AlertDialog open={isGameOver}>
        <AlertDialogContent>
          <AlertDialogHeader>
            <AlertDialogTitle>게임 종료!</AlertDialogTitle>
            <AlertDialogDescription>
              최종 점수: {score}
            </AlertDialogDescription>
          </AlertDialogHeader>
          <AlertDialogAction onClick={startGame}>다시 시작</AlertDialogAction>
        </AlertDialogContent>
      </AlertDialog>
    </div>
  );
};

export default ColorFillGame;
